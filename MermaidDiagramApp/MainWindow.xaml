<?xml version="1.0" encoding="utf-8"?>
<Window
    x:Class="MermaidDiagramApp.MainWindow"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:local="using:MermaidDiagramApp"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:tcb="using:TextControlBoxNS"
    xmlns:controls="using:CommunityToolkit.WinUI.UI.Controls"
    mc:Ignorable="d"
    Title="MermaidDiagramApp">

    <Window.SystemBackdrop>
        <MicaBackdrop />
    </Window.SystemBackdrop>

    <Grid RowDefinitions="Auto, *" KeyDown="MainWindow_KeyDown">
        <ContentDialog x:Name="PngExportDialog"
                       Title="Export PNG Options"
                       PrimaryButtonText="Export"
                       CloseButtonText="Cancel"
                       DefaultButton="Primary"
                       MinWidth="320">
            <StackPanel Spacing="12">
                <TextBlock Text="Set the export scale. A higher value increases the image resolution." TextWrapping="Wrap"/>
                <NumberBox x:Name="ScaleNumberBox"
                           Header="Scale"
                           Value="2"
                           Minimum="0.5"
                           Maximum="10"
                           SpinButtonPlacementMode="Compact"
                           SmallChange="0.5"/>
            </StackPanel>
        </ContentDialog>

        <MenuBar x:Name="MainMenuBar">
            <MenuBarItem Title="File">
                <MenuFlyoutSubItem Text="New">
                    <MenuFlyoutItem Text="Class Diagram" Click="NewClassDiagram_Click"/>
                    <MenuFlyoutItem Text="Sequence Diagram" Click="NewSequenceDiagram_Click"/>
                    <MenuFlyoutItem Text="State Diagram" Click="NewStateDiagram_Click"/>
                    <MenuFlyoutItem Text="Activity Diagram" Click="NewActivityDiagram_Click"/>
                    <MenuFlyoutSeparator/>
                    <MenuFlyoutItem Text="Flowchart" Click="NewFlowchart_Click"/>
                    <MenuFlyoutItem Text="Gantt Chart" Click="NewGanttChart_Click"/>
                    <MenuFlyoutItem Text="Pie Chart" Click="NewPieChart_Click"/>
                    <MenuFlyoutItem Text="Git Graph" Click="NewGitGraph_Click"/>
                </MenuFlyoutSubItem>
                <MenuFlyoutItem Text="Open" Click="Open_Click"/>
                <MenuFlyoutItem Text="Save" Click="Save_Click"/>
                <MenuFlyoutSubItem Text="Export">
                    <MenuFlyoutItem Text="as SVG" Click="ExportSvg_Click"/>
                    <MenuFlyoutItem Text="as PNG" Click="ExportPng_Click"/>
                </MenuFlyoutSubItem>
                <MenuFlyoutSeparator/>
                <MenuFlyoutItem Text="Exit" Click="Exit_Click"/>
            </MenuBarItem>
            <MenuBarItem Title="View">
                <ToggleMenuFlyoutItem x:Name="PanTool" Text="Pan Tool" Click="PanTool_Click"/>
                <MenuFlyoutItem Text="Full Screen" Click="ToggleFullScreen_Click">
                    <MenuFlyoutItem.KeyboardAccelerators>
                        <KeyboardAccelerator Key="F11"/>
                    </MenuFlyoutItem.KeyboardAccelerators>
                </MenuFlyoutItem>
            </MenuBarItem>
        </MenuBar>

                <Grid Grid.Row="1" Padding="12" x:Name="MainGrid">
            <Grid.ColumnDefinitions>
                <ColumnDefinition x:Name="EditorColumn" Width="*"/>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition x:Name="PreviewColumn" Width="*"/>
            </Grid.ColumnDefinitions>
            <tcb:TextControlBox
                x:Name="CodeEditor"
                Grid.Column="0"
                ShowLineNumbers="True"/>

            <controls:GridSplitter x:Name="GridSplitter"
                                   Grid.Column="1"
                                   Width="12"
                                   ResizeBehavior="BasedOnAlignment"
                                   ResizeDirection="Auto"
                                   Background="Transparent"/>

            <WebView2 x:Name="PreviewBrowser" Grid.Column="2"/>
        </Grid>
    </Grid>
</Window>
